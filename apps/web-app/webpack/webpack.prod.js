// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸš€ Webpack ç”Ÿäº§é…ç½® - æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–ï¼ˆé¢è¯•é‡ç‚¹ï¼‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const { merge } = require('webpack-merge');
const common = require('./webpack.common.js');
const CompressionWebpackPlugin = require('compression-webpack-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
const { InjectManifest } = require('workbox-webpack-plugin');
const { GuessPlugin } = require('guess-webpack');

module.exports = merge(common, {
  mode: 'production',

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ—ºï¸ SourceMap é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  /**
   * hidden-source-mapï¼š
   *
   * ç‰¹ç‚¹ï¼š
   * - ç”Ÿæˆå®Œæ•´çš„ SourceMap æ–‡ä»¶
   * - ä½†ä¸åœ¨ä»£ç ä¸­å¼•ç”¨ï¼ˆç”¨æˆ·çœ‹ä¸åˆ°ï¼‰
   * - å¯ä»¥ä¸Šä¼ åˆ°é”™è¯¯ç›‘æ§å¹³å°ï¼ˆå¦‚ Sentryï¼‰
   * - å†…éƒ¨è°ƒè¯•æ—¶å¯ä»¥æ‰‹åŠ¨åŠ è½½
   *
   * ä¸ºä»€ä¹ˆä¸ç”¨ source-mapï¼Ÿ
   * - source-map ä¼šåœ¨ä»£ç æœ«å°¾æ·»åŠ æ³¨é‡ŠæŒ‡å‘ .map æ–‡ä»¶
   * - æš´éœ²æºç ç»“æ„ï¼Œä¸å®‰å…¨
   *
   * ä¸ºä»€ä¹ˆä¸ç”¨ falseï¼ˆä¸ç”Ÿæˆï¼‰ï¼Ÿ
   * - ç”Ÿäº§ç¯å¢ƒé‡åˆ°é”™è¯¯éš¾ä»¥è°ƒè¯•
   * - hidden æ—¢å®‰å…¨åˆå¯è°ƒè¯•
   */
  devtool: 'hidden-source-map',

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®ï¼ˆé¢è¯•æ ¸å¿ƒï¼‰
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  optimization: {
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 1ï¸âƒ£ ä»£ç å‹ç¼©
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    minimize: true,
    minimizer: [
      // Webpack 5 é»˜è®¤ä½¿ç”¨ Terser å‹ç¼© JS
      // è¿™é‡Œä½¿ç”¨ '...' ä¿ç•™é»˜è®¤é…ç½®ï¼ŒåŒæ—¶æ·»åŠ  CSS å‹ç¼©
      '...',

      /**
       * CSS å‹ç¼©
       *
       * css-minimizer-webpack-plugin åŠŸèƒ½ï¼š
       * - å‹ç¼© CSS ä»£ç 
       * - ç§»é™¤æ³¨é‡Š
       * - åˆå¹¶è§„åˆ™
       */
      new CssMinimizerPlugin(),
    ],

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 2ï¸âƒ£ è¿è¡Œæ—¶ä»£ç å•ç‹¬æå–
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * runtimeChunk: 'single'
     *
     * å°† Webpack è¿è¡Œæ—¶ä»£ç æå–åˆ°å•ç‹¬çš„æ–‡ä»¶
     *
     * ä¸ºä»€ä¹ˆè¦æå–ï¼Ÿ
     * - è¿è¡Œæ—¶ä»£ç åŒ…å«æ¨¡å—åŠ è½½é€»è¾‘
     * - æ¯æ¬¡ä¿®æ”¹ä»£ç ï¼Œè¿è¡Œæ—¶çš„ hash ä¹Ÿä¼šå˜
     * - æå–åï¼Œè¿è¡Œæ—¶ç‹¬ç«‹ï¼Œå…¶ä»– chunk çš„ hash æ›´ç¨³å®š
     * - æ›´å¥½åœ°åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜
     */
    runtimeChunk: 'single',

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 3ï¸âƒ£ Code Splitting ç­–ç•¥ï¼ˆé¢è¯•é‡ç‚¹ï¼‰
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * splitChunks é…ç½®è¯´æ˜ï¼š
     *
     * ä¸ºä»€ä¹ˆéœ€è¦ Code Splittingï¼Ÿ
     * 1. å‡å°å•ä¸ªæ–‡ä»¶ä½“ç§¯ï¼ˆåŠ è½½æ›´å¿«ï¼‰
     * 2. å¹¶è¡ŒåŠ è½½å¤šä¸ªæ–‡ä»¶ï¼ˆåˆ©ç”¨ HTTP/2ï¼‰
     * 3. æ›´å¥½çš„ç¼“å­˜ç­–ç•¥ï¼ˆvendor ä»£ç å¾ˆå°‘å˜åŒ–ï¼‰
     * 4. æŒ‰éœ€åŠ è½½ï¼ˆè·¯ç”±æ‡’åŠ è½½ï¼‰
     *
     * ç­–ç•¥è®¾è®¡ï¼š
     * - 6 å±‚æ‹†åˆ†ï¼šreactVendorã€web3Vendorã€utilsVendorã€monorepoSharedã€defaultVendorsã€common
     * - ä¼˜å…ˆçº§ï¼šä»é«˜åˆ°ä½ï¼ˆpriority æ•°å€¼è¶Šå¤§è¶Šä¼˜å…ˆï¼‰
     * - enforce: true å¼ºåˆ¶åˆ†ç¦»ï¼Œå³ä½¿æ¨¡å—å¾ˆå°
     */
    splitChunks: {
      chunks: 'all', // å¯¹æ‰€æœ‰ chunk ç”Ÿæ•ˆï¼ˆåŒ…æ‹¬å¼‚æ­¥å’ŒåŒæ­¥ï¼‰

      maxInitialRequests: 25, // å…è®¸æ›´å¤šåˆå§‹å¹¶è¡Œè¯·æ±‚ï¼ˆHTTP/2 æ”¯æŒï¼‰
      minSize: 20000, // æœ€å° chunk å¤§å° 20KB

      cacheGroups: {
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ğŸ”¹ ç¬¬ 1 å±‚ï¼šReact æ ¸å¿ƒåº“ï¼ˆä¼˜å…ˆçº§ 40ï¼‰
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        /**
         * ä¸ºä»€ä¹ˆå•ç‹¬æ‹†åˆ† Reactï¼Ÿ
         * - Reactã€React-DOM ä½“ç§¯å¤§ï¼ˆ~130KB gzippedï¼‰
         * - å‡ ä¹ä¸ä¼šæ”¹å˜ï¼ˆé•¿æœŸç¼“å­˜ï¼‰
         * - æ‰€æœ‰é¡µé¢éƒ½éœ€è¦ï¼ˆä¼˜å…ˆåŠ è½½ï¼‰
         */
        reactVendor: {
          test: /[\\/]node_modules[\\/](react|react-dom|react-router-dom)[\\/]/,
          name: 'vendor-react',
          priority: 40,
          enforce: true, // å¼ºåˆ¶åˆ†ç¦»
        },

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ğŸ”¹ ç¬¬ 2 å±‚ï¼šWeb3 åº“ï¼ˆä¼˜å…ˆçº§ 35ï¼‰
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        /**
         * ä¸ºä»€ä¹ˆå•ç‹¬æ‹†åˆ† Web3ï¼Ÿ
         * - web3.js ä½“ç§¯éå¸¸å¤§ï¼ˆ~500KBï¼‰
         * - ä¸æ˜¯æ‰€æœ‰é¡µé¢éƒ½éœ€è¦ï¼ˆé¦–é¡µä¸éœ€è¦ï¼‰
         * - å»¶è¿ŸåŠ è½½å¯ä»¥æå‡é¦–å±é€Ÿåº¦
         */
        web3Vendor: {
          test: /[\\/]node_modules[\\/]web3[\\/]/,
          name: 'vendor-web3',
          priority: 35,
          enforce: true,
        },

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ğŸ”¹ ç¬¬ 3 å±‚ï¼šå·¥å…·åº“ï¼ˆä¼˜å…ˆçº§ 30ï¼‰
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        /**
         * SWRã€localforageã€quicklink ç­‰è½»é‡å·¥å…·åº“
         *
         * ä¸ºä»€ä¹ˆæ”¾åœ¨ä¸€èµ·ï¼Ÿ
         * - éƒ½æ˜¯å°å‹å·¥å…·åº“ï¼ˆæ€»è®¡ < 50KBï¼‰
         * - ä½¿ç”¨é¢‘ç‡ç›¸è¿‘
         * - åˆå¹¶åå‡å°‘ HTTP è¯·æ±‚æ•°
         */
        utilsVendor: {
          test: /[\\/]node_modules[\\/](swr|localforage|quicklink)[\\/]/,
          name: 'vendor-utils',
          priority: 30,
          enforce: true,
        },

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ğŸ”¹ ç¬¬ 4 å±‚ï¼šMonorepo å…±äº«åŒ…ï¼ˆä¼˜å…ˆçº§ 25ï¼‰
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        /**
         * ä¸ºä»€ä¹ˆå•ç‹¬æ‹†åˆ† @qincai/* åŒ…ï¼Ÿ
         *
         * é¢è¯•äº®ç‚¹ï¼š
         * - å±•ç¤ºå¯¹ Monorepo æ¶æ„çš„ç†è§£
         * - @qincai/uiã€@qincai/hooksã€@qincai/libs æ˜¯å…±äº«ä»£ç 
         * - å•ç‹¬ chunk å¯ä»¥è¢«å¤šä¸ªé¡µé¢å¤ç”¨
         * - ä¿®æ”¹åº”ç”¨ä»£ç æ—¶ï¼Œshared chunk ä¸å˜ï¼ˆç¼“å­˜ç¨³å®šï¼‰
         *
         * é€šè¿‡ SourceMap å¯ä»¥å®šä½åˆ° packages æºç ï¼š
         * - webpack://web-app/../../packages/qc-ui/src/Button.tsx
         */
        monorepoShared: {
          test: /[\\/]packages[\\/](qc-libs|qc-hooks|qc-ui)[\\/]/,
          name: 'shared-qincai',
          priority: 25,
          enforce: true,
        },

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ğŸ”¹ ç¬¬ 5 å±‚ï¼šå…¶ä»– node_modulesï¼ˆä¼˜å…ˆçº§ 10ï¼‰
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        /**
         * å…œåº•ï¼šæ‰€æœ‰å…¶ä»–ç¬¬ä¸‰æ–¹åº“
         */
        defaultVendors: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10,
        },

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ğŸ”¹ ç¬¬ 6 å±‚ï¼šå…¬å…±ä»£ç ï¼ˆä¼˜å…ˆçº§ 5ï¼‰
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        /**
         * è¢«å¤šä¸ª chunk ä½¿ç”¨çš„åº”ç”¨ä»£ç 
         *
         * minChunks: 2 - è‡³å°‘è¢« 2 ä¸ª chunk å¼•ç”¨
         * reuseExistingChunk: true - å¤ç”¨å·²å­˜åœ¨çš„ chunk
         */
        common: {
          minChunks: 2,
          name: 'common',
          priority: 5,
          reuseExistingChunk: true,
        },
      },
    },

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 4ï¸âƒ£ Tree Shaking ä¼˜åŒ–
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * usedExports: æ ‡è®°æœªä½¿ç”¨çš„å¯¼å‡º
     * sideEffects: æ ¹æ® package.json çš„ sideEffects å­—æ®µä¼˜åŒ–
     *
     * é…åˆæ¡ä»¶ï¼š
     * - ä½¿ç”¨ ES Moduleï¼ˆimport/exportï¼‰
     * - package.json é…ç½® "sideEffects": false
     */
    usedExports: true,
    sideEffects: true,
  },

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ”Œ ç”Ÿäº§ç¯å¢ƒæ’ä»¶ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  plugins: [
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 0ï¸âƒ£ Guess.js æ™ºèƒ½é¢„æµ‹åŠ è½½ï¼ˆé¢è¯•äº®ç‚¹ï¼‰
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * Guess.js å·¥ä½œåŸç†ï¼š
     *
     * 1. æ•°æ®æ”¶é›†ï¼š
     *    - éœ€è¦ Google Analytics å†å²æ•°æ®
     *    - åˆ†æç”¨æˆ·è·¯ç”±è·³è½¬æ¨¡å¼
     *
     * 2. ML æ¨¡å‹è®­ç»ƒï¼š
     *    - ä½¿ç”¨ TensorFlow.js è®­ç»ƒé¢„æµ‹æ¨¡å‹
     *    - é¢„æµ‹ç”¨æˆ·ä¸‹ä¸€æ­¥æœ€å¯èƒ½è®¿é—®çš„è·¯ç”±
     *
     * 3. æ™ºèƒ½é¢„åŠ è½½ï¼š
     *    - åœ¨å½“å‰è·¯ç”±ï¼Œé¢„åŠ è½½é«˜æ¦‚ç‡çš„ä¸‹ä¸€è·³è·¯ç”±
     *    - å‡å°‘ç”¨æˆ·æ„ŸçŸ¥çš„åŠ è½½æ—¶é—´
     *
     * æ³¨æ„ï¼šæ–°é¡¹ç›®æ— å†å²æ•°æ®æ—¶çš„æ›¿ä»£æ–¹æ¡ˆ
     * - æ–¹æ¡ˆ 1ï¼šä½¿ç”¨é™æ€é…ç½®ï¼ˆrouteConfig.tsï¼‰
     * - æ–¹æ¡ˆ 2ï¼šç»“åˆ Quicklinkï¼ˆè§†å£å†…é“¾æ¥é¢„åŠ è½½ï¼‰
     * - æ–¹æ¡ˆ 3ï¼šäººå·¥åˆ†æç”¨æˆ·æµç¨‹ï¼Œé…ç½®é¢„åŠ è½½è§„åˆ™
     *
     * é¢è¯•è¯æœ¯ï¼š
     * "Guess.js éœ€è¦ GA æ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œæ–°é¡¹ç›®å¯ä»¥å…ˆç”¨ Quicklink
     * ç»“åˆé™æ€è·¯ç”±é¢„æµ‹ï¼Œç­‰æœ‰æ•°æ®åå†æ¥å…¥ Guess.js"
     */
    new GuessPlugin({
      // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      // ğŸ¯ è‡ªé€‚åº”æ•°æ®æºé…ç½®ï¼ˆé¢è¯•äº®ç‚¹ï¼‰
      // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

      /**
       * GA View ID é…ç½®
       *
       * ä½¿ç”¨æ–¹å¼ï¼š
       * 1. æ–°é¡¹ç›®ï¼šä¸å¡«å†™ GAï¼Œä½¿ç”¨é™æ€é…ç½® + Quicklink
       * 2. æœ‰ GA æ•°æ®ï¼šå¡«å†™ GA View IDï¼Œè‡ªåŠ¨å¯ç”¨ ML é¢„æµ‹
       *
       * ç¯å¢ƒå˜é‡é…ç½®ï¼š
       * - GUESS_GA_VIEW_ID: GA View IDï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
       * - ä¸è®¾ç½®åˆ™è‡ªåŠ¨é™çº§
       *
       * é¢è¯•è¯æœ¯ï¼š
       * "è®¾è®¡äº†è‡ªé€‚åº”é™çº§æ¶æ„ï¼Œè¿è¡Œæ—¶æ£€æµ‹ GA æ•°æ®å¯ç”¨æ€§ï¼Œ
       * æ— éœ€é‡æ–°å‘ç‰ˆå³å¯å¯ç”¨ Guess.jsï¼Œç¡®ä¿å¹³æ»‘è¿‡æ¸¡"
       */
      GA: process.env.GUESS_GA_VIEW_ID, // ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œæœªè®¾ç½®åˆ™ undefined

      /**
       * è‡ªå®šä¹‰æ•°æ®æº
       *
       * ä¼˜å…ˆçº§ï¼š
       * 1. GA æ•°æ®ï¼ˆå¦‚æœé…ç½®äº† GA View IDï¼‰
       * 2. reportProvider è‡ªå®šä¹‰æ•°æ®æº
       * 3. éƒ½æ²¡æœ‰ â†’ è¿”å›ç©ºå¯¹è±¡ â†’ é™çº§åˆ°é™æ€é…ç½®
       *
       * å¯é€‰æ–¹æ¡ˆï¼šä»è‡ªå·±çš„åç«¯ API è·å–æ•°æ®
       */
      reportProvider() {
        // æ–¹æ¡ˆ 1ï¼šä»ç¯å¢ƒå˜é‡æˆ–è‡ªå·±çš„ API è·å–æ•°æ®
        const customReportUrl = process.env.GUESS_REPORT_URL;

        if (customReportUrl) {
          // ä»è‡ªå·±çš„æœåŠ¡å™¨è·å–ç”¨æˆ·è¡Œä¸ºåˆ†ææ•°æ®
          return fetch(customReportUrl)
            .then(res => res.json())
            .catch(() => {
              console.log('[Guess.js] è‡ªå®šä¹‰æ•°æ®æºä¸å¯ç”¨ï¼Œé™çº§åˆ°é™æ€é…ç½®');
              return {};
            });
        }

        // æ–¹æ¡ˆ 2ï¼šæ²¡æœ‰è‡ªå®šä¹‰æ•°æ®æºï¼Œè¿”å›ç©ºå¯¹è±¡ï¼ˆé™çº§ï¼‰
        // Guess.js ä¼šæ£€æµ‹åˆ°ç©ºæ•°æ®ï¼Œä¸æ‰§è¡Œé¢„æµ‹
        // é™æ€é…ç½® + Quicklink ç»§ç»­å·¥ä½œ
        return Promise.resolve({});
      },

      // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      // ğŸ”§ è¿è¡Œæ—¶é…ç½®
      // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

      runtime: {
        /**
         * delegate: false
         *
         * ä¸ä½¿ç”¨ Guess.js çš„é»˜è®¤é¢„åŠ è½½é€»è¾‘
         * åŸå› ï¼šæˆ‘ä»¬æœ‰è‡ªå·±çš„ PredictiveRouter ç»Ÿä¸€ç®¡ç†é¢„åŠ è½½
         *
         * å¦‚æœè®¾ç½®ä¸º trueï¼š
         * - Guess.js ä¼šè‡ªåŠ¨æ³¨å…¥é¢„åŠ è½½ä»£ç 
         * - å¯èƒ½ä¸æˆ‘ä»¬çš„é™æ€é…ç½®å†²çª
         */
        delegate: false,
      },

      /**
       * é¢„å–é˜ˆå€¼
       *
       * åªæœ‰æ¦‚ç‡ > 30% çš„è·¯ç”±æ‰ä¼šè¢«é¢„åŠ è½½
       * é¿å…é¢„åŠ è½½è¿‡å¤šä½æ¦‚ç‡è·¯ç”±æµªè´¹å¸¦å®½
       */
      prefetchThreshold: 0.3,

      /**
       * è°ƒè¯•æ¨¡å¼
       *
       * å¼€å¯åä¼šåœ¨æ§åˆ¶å°è¾“å‡ºé¢„æµ‹è¯¦æƒ…
       * ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­
       */
      debug: process.env.NODE_ENV !== 'production' || process.env.DEBUG === 'true',
    }),

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 1ï¸âƒ£ Gzip å‹ç¼©
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * CompressionWebpackPlugin åŠŸèƒ½ï¼š
     * - é¢„å…ˆç”Ÿæˆ .gz æ–‡ä»¶
     * - Nginx é…ç½® gzip_static on åç›´æ¥ä½¿ç”¨
     * - é¿å…è¿è¡Œæ—¶å‹ç¼©ï¼ˆèŠ‚çœ CPUï¼‰
     *
     * é…ç½®è¯´æ˜ï¼š
     * - algorithm: 'gzip' - ä½¿ç”¨ gzip ç®—æ³•
     * - test: åŒ¹é… js/css/html/svg æ–‡ä»¶
     * - threshold: 10KB - å¤§äº 10KB æ‰å‹ç¼©
     * - minRatio: 0.8 - å‹ç¼©ç‡ < 0.8 æ‰ä¿ç•™ï¼ˆè‡³å°‘å‡å°‘ 20%ï¼‰
     */
    new CompressionWebpackPlugin({
      algorithm: 'gzip',
      test: /\.(js|css|html|svg)$/,
      threshold: 10240, // 10KB
      minRatio: 0.8,
      filename: '[path][base].gz',
    }),

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 2ï¸âƒ£ Brotli å‹ç¼©ï¼ˆä¼˜å…ˆçº§é«˜äº Gzipï¼‰
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * Brotli vs Gzipï¼š
     *
     * å‹ç¼©ç‡å¯¹æ¯”ï¼š
     * - Gzip: çº¦ 70% å‹ç¼©ç‡
     * - Brotli: çº¦ 80% å‹ç¼©ç‡ï¼ˆlevel 11ï¼‰
     *
     * æµè§ˆå™¨æ”¯æŒï¼š
     * - Gzip: æ‰€æœ‰æµè§ˆå™¨
     * - Brotli: ç°ä»£æµè§ˆå™¨ï¼ˆChrome 50+ã€Firefox 44+ï¼‰
     *
     * Nginx é…ç½®ï¼š
     * - Accept-Encoding: br,gzip
     * - Nginx ä¼˜å…ˆè¿”å› .br æ–‡ä»¶
     * - ä¸æ”¯æŒæ—¶é™çº§åˆ° .gz
     */
    new CompressionWebpackPlugin({
      algorithm: 'brotliCompress',
      test: /\.(js|css|html|svg)$/,
      threshold: 10240,
      minRatio: 0.8,
      filename: '[path][base].br',
      compressionOptions: {
        level: 11, // Brotli å‹ç¼©çº§åˆ«ï¼ˆ0-11ï¼Œ11 æœ€é«˜ï¼‰
      },
    }),

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // 3ï¸âƒ£ Service Worker ç”Ÿæˆï¼ˆWorkboxï¼‰
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    /**
     * Workbox InjectManifest æ¨¡å¼ï¼š
     *
     * ä¸ GenerateSW çš„åŒºåˆ«ï¼š
     * - GenerateSW: è‡ªåŠ¨ç”Ÿæˆ SWï¼Œé…ç½®ç®€å•ä½†çµæ´»æ€§ä½
     * - InjectManifest: ä½¿ç”¨è‡ªå®šä¹‰ SWï¼Œæ³¨å…¥é¢„ç¼“å­˜æ¸…å•
     *
     * é…ç½®è¯´æ˜ï¼š
     * - swSrc: Service Worker æºæ–‡ä»¶
     * - swDest: è¾“å‡ºçš„ SW æ–‡ä»¶å
     * - exclude: æ’é™¤ä¸éœ€è¦ç¼“å­˜çš„æ–‡ä»¶
     * - maximumFileSizeToCacheInBytes: 5MBï¼ˆé¿å…ç¼“å­˜è¿‡å¤§æ–‡ä»¶ï¼‰
     *
     * é¢è¯•äº®ç‚¹ï¼š
     * - å±•ç¤ºå¯¹ PWA çš„æ·±åº¦ç†è§£
     * - è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥ï¼ˆCache Firstã€Network Firstã€SWRï¼‰
     * - ç¦»çº¿é™çº§æ–¹æ¡ˆ
     */
    new InjectManifest({
      swSrc: './src/workers/service-worker.ts',
      swDest: 'service-worker.js',
      exclude: [
        /\.map$/,               // SourceMap
        /^manifest.*\.js$/,     // Webpack manifest
      ],
      maximumFileSizeToCacheInBytes: 5 * 1024 * 1024, // 5MB
    }),
  ],

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ“Š æ€§èƒ½æç¤º
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  /**
   * æ–‡ä»¶ä½“ç§¯é™åˆ¶ï¼ˆè§¦å‘è­¦å‘Šï¼‰
   *
   * ä¸ºä»€ä¹ˆè®¾ç½® 500KBï¼Ÿ
   * - 3G ç½‘ç»œä¸‹çº¦ 2-3 ç§’åŠ è½½
   * - å»ºè®®é¦–å±èµ„æº < 500KB
   * - è¶…è¿‡æ—¶æç¤ºä¼˜åŒ–ï¼ˆæ‹†åˆ†ã€æ‡’åŠ è½½ï¼‰
   */
  performance: {
    maxEntrypointSize: 512000,  // å…¥å£æ–‡ä»¶æœ€å¤§ 500KB
    maxAssetSize: 512000,        // èµ„æºæ–‡ä»¶æœ€å¤§ 500KB
    hints: 'warning',            // è¶…è¿‡æ—¶æ˜¾ç¤ºè­¦å‘Š
  },
});
