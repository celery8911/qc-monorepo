// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ› ï¸ Webpack å¼€å‘é…ç½®
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const { merge } = require('webpack-merge');
const common = require('./webpack.common.js');
const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');

module.exports = merge(common, {
  mode: 'development',

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ—ºï¸ SourceMap é…ç½®
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  /**
   * eval-cheap-module-source-mapï¼š
   *
   * ç‰¹ç‚¹ï¼š
   * - evalï¼šæ¯ä¸ªæ¨¡å—ç”¨ eval() åŒ…è£¹ï¼ˆæœ€å¿«çš„é‡å»ºé€Ÿåº¦ï¼‰
   * - cheapï¼šåªä¿ç•™è¡Œä¿¡æ¯ï¼Œä¸ä¿ç•™åˆ—ä¿¡æ¯
   * - moduleï¼šä¿ç•™ loader å¤„ç†å‰çš„æºç ï¼ˆèƒ½çœ‹åˆ°åŸå§‹ TypeScriptï¼‰
   * - source-mapï¼šç”Ÿæˆ SourceMap
   *
   * ä¼˜ç‚¹ï¼š
   * âœ… é‡å»ºé€Ÿåº¦å¿«ï¼ˆé€‚åˆå¼€å‘ç¯å¢ƒï¼‰
   * âœ… ä¿ç•™è¡Œå·ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
   * âœ… å¯ä»¥å®šä½åˆ° monorepo packages çš„æºç 
   *
   * ç¼ºç‚¹ï¼š
   * âŒ ç”Ÿäº§ç¯å¢ƒä¸å®‰å…¨ï¼ˆæš´éœ²æºç ï¼‰
   * âŒ ä¸ä¿ç•™åˆ—ä¿¡æ¯ï¼ˆè°ƒè¯•ç²¾åº¦ç•¥ä½ï¼‰
   */
  devtool: 'eval-cheap-module-source-map',

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸš€ DevServer é…ç½®
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  devServer: {
    // é™æ€æ–‡ä»¶ç›®å½•
    static: './public',

    // çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰
    hot: true,

    // ç«¯å£å·
    port: 3000,

    // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    open: true,

    /**
     * historyApiFallback: æ”¯æŒ React Router
     *
     * åŸç†ï¼š
     * - SPA ä½¿ç”¨å®¢æˆ·ç«¯è·¯ç”±ï¼ˆå¦‚ /wallet/0x123ï¼‰
     * - åˆ·æ–°é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚æœåŠ¡å™¨çš„ /wallet/0x123
     * - æœåŠ¡å™¨è¿”å› 404ï¼ˆå› ä¸ºæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼‰
     * - historyApiFallback å°†æ‰€æœ‰è¯·æ±‚é‡å®šå‘åˆ° index.html
     * - React Router æ¥ç®¡åæ­£ç¡®æ˜¾ç¤ºé¡µé¢
     */
    historyApiFallback: true,

    // Gzip å‹ç¼©
    compress: true,

    /**
     * é”™è¯¯è¦†ç›–å±‚é…ç½®
     *
     * å¼€å‘æ—¶ç¼–è¯‘é”™è¯¯ä¼šè¦†ç›–æ•´ä¸ªé¡µé¢
     * è­¦å‘Šä¸æ˜¾ç¤ºï¼ˆé¿å…å¹²æ‰°ï¼‰
     */
    client: {
      overlay: {
        errors: true,
        warnings: false,
      },
    },
  },

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ”Œ å¼€å‘ç¯å¢ƒæ’ä»¶
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  plugins: [
    /**
     * React Fast Refresh æ’ä»¶
     *
     * åŠŸèƒ½ï¼š
     * - ä¿®æ”¹ React ç»„ä»¶æ—¶ï¼Œä¿ç•™ç»„ä»¶çŠ¶æ€
     * - ä¸ä¼šæ•´é¡µåˆ·æ–°ï¼ˆæ¯”ä¼ ç»Ÿ HMR æ›´å¿«ï¼‰
     * - è‡ªåŠ¨å¤„ç† Hooks çš„é‡æ–°æŒ‚è½½
     *
     * ä¸ HMR çš„åŒºåˆ«ï¼š
     * - HMRï¼šæ¨¡å—çº§çƒ­æ›´æ–°ï¼ˆçŠ¶æ€ä¸¢å¤±ï¼‰
     * - Fast Refreshï¼šç»„ä»¶çº§çƒ­æ›´æ–°ï¼ˆçŠ¶æ€ä¿ç•™ï¼‰
     *
     * é…åˆ SWC ä½¿ç”¨ï¼š
     * - éœ€è¦åœ¨ .swcrc ä¸­å¯ç”¨ refresh: true
     * - æˆ–åœ¨ swc-loader çš„ options ä¸­é…ç½®
     */
    new ReactRefreshWebpackPlugin(),
  ],

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // âš¡ å¼€å‘ç¯å¢ƒä¼˜åŒ–
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  optimization: {
    /**
     * moduleIds: 'named'
     *
     * ä½¿ç”¨æ¨¡å—è·¯å¾„ä½œä¸º IDï¼ˆè€Œä¸æ˜¯æ•°å­—ï¼‰
     * å¥½å¤„ï¼šè°ƒè¯•æ—¶æ›´å®¹æ˜“è¯†åˆ«æ¨¡å—
     */
    moduleIds: 'named',

    /**
     * runtimeChunk: 'single'
     *
     * å°† Webpack è¿è¡Œæ—¶ä»£ç æå–åˆ°å•ç‹¬çš„ chunk
     * å¥½å¤„ï¼š
     * - ç¼“å­˜æ›´ç¨³å®š
     * - å¤šä¸ª entry å…±äº«è¿è¡Œæ—¶
     */
    runtimeChunk: 'single',
  },

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ”§ SWC Loader å¼€å‘ç¯å¢ƒè¦†ç›–é…ç½®
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  module: {
    rules: [
      {
        test: /\.(ts|tsx|js|jsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'swc-loader',
          options: {
            // è¦†ç›– .swcrc ä¸­çš„é…ç½®
            jsc: {
              transform: {
                react: {
                  development: true,  // å¼€å‘æ¨¡å¼
                  refresh: true,      // å¯ç”¨ React Fast Refresh
                },
              },
            },
          },
        },
      },
    ],
  },
});
